

1- Modular Feature Architecture (Feature Modules).
Cada feature contiene sus piezas internas, mientras que app/ contiene únicamente el routing.
Es un patrón de organización donde cada feature del negocio tiene un módulo autocontenido que incluye UI, lógica, tipos y utilidades, mientras que las rutas viven aparte (en app/) y funcionan como puntos de entrada.

2 - Para editar una cuenta de usuario (OPERATOR, SUPERVISOR, ADMIN) debe hacerse desde el panel de Clerk
3- Webhook de Clerk que apunta a: https://263fdb80536a.ngrok-free.app/api/users/sync. eventos a los que suscribe: 
session.created
session.ended
session.revoked
user.created
user.deleted
user.updated
Esto crea/edita/elimina la/las cuentas en la base de datos para utilizar en las auditorias. Se sincroniza la info de las cuentas de clerk y mi base de datos.
4- La creación de cuentas está deshabilitada desde clerk. solo el desarrollador puede crear cuentas.


5- Comandos para ejecutar los archivos seeds y cargar la base de datos de data de prueba: 
    ----crear provincias y ciudades: npx tsx prisma/scripts/create-provinces-and-cities.ts
    ----crear 10 afiliados: npx tsx prisma/scripts/create-affiliates.ts
    ----crear 7 servicios: npx tsx prisma/scripts/create-services.ts
    ----crear organizaciones: npx tsx prisma/scripts/create-organizations.ts
    ----crear medicamentos: npx tsx prisma/scripts/create-pharmacy-medications.ts

    

6- en app > api > services > find-all - route.ts se cachea la response con un tiempo de 1 semana ya que rara vez van a cambiar.
    
7- stablecí en la configuracion de clerk en el apartado Sessions que el Maximun lifetime sea de 1 dia en vez de 7, si bien se puede hacer, pero en el plan free esto solo funciona en development, para produccion hay que pagar.

8- en el layout.tsx principal configuré en el ClerkProvider que se redireccione a "/" cuando se cierra sesión.

9- para crear los distintos tipos de vistas segun el rol de la cuenta autenticada se utiliza un endpoint en la carpeta api, ya que clerk no administra el tipo de cuenta/rol, solo maneja el login. para realizar las verificaciones de que tipo de cuenta está activa utilizo mi base de datos, por eso creo un endpoint para esto.

10- Los archivos de componentes deben comenzar con mayúscula (PascalCase). Usar named exports en lugar de default exports.

11- Cuando reseteo la base para aplciar nuevos cambios en el schema.prisma, debo volver a crear el/los usuarios manualmente desde la pagina de clerk y actualizar el link del endpoint del webhook en clerk y loguearme con la/las cuentas creadas desde el link de ngrok para que esa/esas cuentas se creen en la base de datos. luego de hacer esto ya se puede acceder con el link: localhost:3000 y como el/los usuarios ya existen en la base ya permite loguearse correctamente.

12- Los nombres de los archivos en features > módulo > services utiliza una convención de servicios basada en acciones(backend-driven frontends).Este patrón basado en verbos (get/create/update/delete) expresa claramente la intención del servicio y es exactamente lo que esperaría cualquier desarrollador en un entorno productivo.

13- Un Client Component NO puede acceder directamente a la base de datos, por lo que necesita un endpoint o un server action.
    Un Server Component y Server Actions pueden acceder a la base de datos (ejemplo: db.user.findMany)

14- se implementa RBAC en el archivo proxy.ts para proteger las rutas autenticadas. (por ejemplo: que una cuenta con el rol OPERATOR no pueda modificar la url y acceder a un path que es exclusivo de cuentas con el rol ADMIN). Ademas, en los endpoints hay proteccion adicional a las acciones dependiendo el rol (por ejemplo: si una cuenta con rol OPERATOR pudiera acceder a un path que no debe, no va a poder ejecutar ninguna accion de agregar/editar/eliminar/ver porque los endpoints verifican el rol de la cuenta que solicita la accion.)

15- Seguridad de la pagina ---- existen tres niveles de control, cada uno con un objetivo distinto:
        capa 1 -  archivo:  proxy.ts (middleware) objetivo: Control de acceso a rutas (autorización coarse-grained)
        capa 2 - archivo: app > (private) - layout.tsx objetivo: Garantizar sesión + usuario DB consistente.
        capa 3 - archivo: app > api (en los endpoints que ejecuten acciones que lo requieran, se utiliza la funcion requireRole) objetivo: Autorización funcional / de negocio (fine-grained)

    grafico arquitectura de seguridad: 
    
     proxy.ts     │  ← protege rutas por prefijo (macro)
└──────┬───────┘
       ↓
┌──────────────┐
│ PrivateLayout│  ← sesión + usuario DB
└──────┬───────┘
       ↓
┌──────────────┐
│ Page         │  ← permisos funcionales / UX
└──────┬───────┘
       ↓
┌──────────────┐
│ API / Action │  ← requireRole (seguridad dura)

16- los endpoints de provinces y cities tienen una cache revalidate de 24hs.



estoy creando una pagina web de uso interno para una obra social con nextjs (version 16) prisma, postgres, typescrypt, shadcn, zod, tailwind. utilizo Modular Feature Architecture (Feature Modules).
Cada feature contiene sus piezas internas, mientras que app/ contiene únicamente el routing.
Es un patrón de organización donde cada feature del negocio tiene un módulo autocontenido que incluye UI, lógica, tipos y utilidades, mientras que las rutas viven aparte (en app/) y funcionan como puntos de entrada.





Mejoras a realizar: 

1- Migrar búsquedas y edición de afiliados a TanStack Query
  - Centralizar cache de afiliados
  - Evitar prop drilling (onUpdated)
  - Manejar sincronización post-mutation automáticamente
  - Posibilitar invalidación / refetch selectivo

usar la funcion updateUserActivity en las acciones que tengan que refrescar el estado online/offline

agregar a la funcion formatLastActivity.ts que distinga dias. 


Mapa mental de como funciona:

OperatorServiceContext

identidad (operador + servicio)

vive en el layout

siempre activo

TurnQueue

estado de turnos

propio del panel

NO conoce farmacia

PharmacyMedicationCart

estado operativo de atención

compartido entre:

área de farmacia

botón “Finalizar turno”

requiere Provider común
















<!DOCTYPE html>
<html class="light" lang="es"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Farmacia Medicamentos - Gestión de Pedidos</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#0f172a", // Deep Navy
              secondary: "#3b82f6", // Vibrant Blue
              "background-light": "#f8fafc",
              "background-dark": "#020617",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
              sans: ["Inter", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.75rem",
              'xl': '1rem',
            },
          },
        },
      };
    </script>
<style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        .glass-card {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen transition-colors duration-200">
<header class="sticky top-0 z-50 w-full border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 glass-card">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
<div class="flex items-center gap-2">
<span class="material-icons-round text-secondary text-3xl">local_pharmacy</span>
<span class="text-xl font-bold tracking-tight text-primary dark:text-white">Farmacia <span class="text-secondary">Medicamentos</span></span>
</div>
<div class="flex items-center gap-4">
<div class="hidden md:flex flex-col items-end mr-2">
<span class="text-sm font-medium text-slate-700 dark:text-slate-200">prueba probando</span>
<span class="text-xs text-slate-500">Farmacéutico de Turno</span>
</div>
<div class="h-10 w-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center border border-slate-300 dark:border-slate-600">
<span class="material-icons-round text-slate-600 dark:text-slate-300">person</span>
</div>
<button class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors" onclick="document.documentElement.classList.toggle('dark')">
<span class="material-icons-round dark:hidden text-slate-600">dark_mode</span>
<span class="material-icons-round hidden dark:block text-slate-300">light_mode</span>
</button>
</div>
</div>
</div>
</header>
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
<div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
<div class="lg:col-span-8 space-y-8">
<section class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
<label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2" for="search">Buscar medicamento</label>
<div class="relative group">
<span class="material-icons-round absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-secondary transition-colors">search</span>
<input class="w-full pl-12 pr-4 py-4 bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-secondary focus:border-transparent transition-all outline-none" id="search" placeholder="Ej. Ibuprofeno, Paracetamol, Amoxicilina..." type="text"/>
<div class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2">
<span class="hidden sm:inline-block px-2 py-1 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded text-[10px] text-slate-400 font-mono">⌘K</span>
</div>
</div>
<div class="mt-4 flex flex-wrap gap-2">
<span class="text-xs text-slate-500 dark:text-slate-400">Sugerencias:</span>
<button class="text-xs font-medium text-secondary hover:underline">Aspirina</button>
<button class="text-xs font-medium text-secondary hover:underline">Loratadina</button>
<button class="text-xs font-medium text-secondary hover:underline">Omeprazol</button>
</div>
</section>
<section class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm min-h-[400px]">
<div class="flex justify-between items-center mb-6">
<h2 class="text-lg font-bold flex items-center gap-2">
<span class="material-icons-round text-secondary">shopping_basket</span>
                            Medicamentos seleccionados
                        </h2>
<span class="bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 px-3 py-1 rounded-full text-sm font-medium">2 productos</span>
</div>
<div class="space-y-3">
<div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 transition-colors group">
<div class="flex items-center gap-4">
<div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400">
<span class="material-icons-round">medication</span>
</div>
<div>
<h4 class="font-semibold text-slate-800 dark:text-slate-100">Paracetamol 500mg</h4>
<p class="text-xs text-slate-500">Caja x 20 comprimidos</p>
</div>
</div>
<div class="flex items-center gap-4">
<div class="flex items-center bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700 p-1">
<button class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-800 rounded text-slate-500">-</button>
<span class="w-8 text-center font-medium">1</span>
<button class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-800 rounded text-slate-500">+</button>
</div>
<button class="p-2 text-slate-400 hover:text-red-500 transition-colors">
<span class="material-icons-round text-lg">delete_outline</span>
</button>
</div>
</div>
<div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 transition-colors group">
<div class="flex items-center gap-4">
<div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600 dark:text-purple-400">
<span class="material-icons-round">medication</span>
</div>
<div>
<h4 class="font-semibold text-slate-800 dark:text-slate-100">Ibuprofeno 600mg</h4>
<p class="text-xs text-slate-500">Suspensión oral</p>
</div>
</div>
<div class="flex items-center gap-4">
<div class="flex items-center bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700 p-1">
<button class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-800 rounded text-slate-500">-</button>
<span class="w-8 text-center font-medium">1</span>
<button class="w-8 h-8 flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-800 rounded text-slate-500">+</button>
</div>
<button class="p-2 text-slate-400 hover:text-red-500 transition-colors">
<span class="material-icons-round text-lg">delete_outline</span>
</button>
</div>
</div>
</div>
<div class="hidden flex-col items-center justify-center py-20 text-slate-400">
<span class="material-icons-round text-6xl mb-4 opacity-20">inventory_2</span>
<p>No hay medicamentos seleccionados</p>
</div>
</section>
</div>
<aside class="lg:col-span-4 space-y-6">
<div class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-lg overflow-hidden">
<div class="p-1 bg-secondary w-full"></div>
<div class="p-6">
<div class="flex items-center justify-between mb-8">
<span class="text-xs font-bold uppercase tracking-wider text-slate-400">Turnos · FM</span>
<span class="flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-[10px] font-bold">
<span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                                EN ATENCIÓN
                            </span>
</div>
<div class="text-center mb-8">
<p class="text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">Turno actual</p>
<h1 class="text-6xl font-black text-primary dark:text-white tracking-tighter">FM-51</h1>
</div>
<div class="space-y-3">
<button class="w-full bg-primary dark:bg-slate-100 dark:text-primary text-white font-bold py-4 rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2">
<span class="material-icons-round">check_circle</span>
                                Finalizar turno
                            </button>
<div class="grid grid-cols-2 gap-3">
<button class="flex-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 font-semibold py-3 px-2 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-sm flex items-center justify-center gap-1">
<span class="material-icons-round text-lg">person_off</span>
                                    No se presentó
                                </button>
<button class="flex-1 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 text-red-600 dark:text-red-400 font-semibold py-3 px-2 rounded-xl hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors text-sm flex items-center justify-center gap-1">
<span class="material-icons-round text-lg">cancel</span>
                                    Cancelar
                                </button>
</div>
</div>
</div>
<div class="px-6 py-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-800 flex items-center justify-between">
<div class="flex -space-x-2">
<div class="w-7 h-7 rounded-full bg-slate-200 dark:bg-slate-700 border-2 border-white dark:border-slate-900 flex items-center justify-center text-[10px] font-bold">FM</div>
<div class="w-7 h-7 rounded-full bg-secondary border-2 border-white dark:border-slate-900"></div>
</div>
<span class="text-xs text-slate-400">Próximo: <b>FM-52</b></span>
</div>
</div>
<div class="p-6 bg-slate-100 dark:bg-slate-800/30 rounded-2xl border border-dashed border-slate-300 dark:border-slate-700">
<h5 class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-4 flex items-center gap-2">
<span class="material-icons-round text-sm">keyboard</span>
                        Atajos rápidos
                    </h5>
<ul class="space-y-2">
<li class="flex justify-between items-center text-sm">
<span class="text-slate-600 dark:text-slate-400 text-xs">Siguiente turno</span>
<kbd class="px-2 py-0.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded shadow-sm font-mono text-[10px]">Space</kbd>
</li>
<li class="flex justify-between items-center text-sm">
<span class="text-slate-600 dark:text-slate-400 text-xs">Limpiar búsqueda</span>
<kbd class="px-2 py-0.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded shadow-sm font-mono text-[10px]">Esc</kbd>
</li>
<li class="flex justify-between items-center text-sm">
<span class="text-slate-600 dark:text-slate-400 text-xs">Finalizar pedido</span>
<kbd class="px-2 py-0.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded shadow-sm font-mono text-[10px]">Enter</kbd>
</li>
</ul>
</div>
</aside>
</div>
</main>
<button class="fixed bottom-6 right-6 lg:hidden w-14 h-14 rounded-full bg-primary text-white shadow-2xl flex items-center justify-center z-[100]">
<span class="material-icons-round">add</span>
</button>

</body></html>